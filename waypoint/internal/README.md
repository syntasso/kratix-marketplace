# Development

## Build promise.yaml
The `promise.yaml` is generated by interpolating the contents of `resources/` into
the `workerClusterResources`.

These resources were generated using `./scripts/fetch-worker-resources`.

To build run:

```
./scripts/inject-wcr
```

### Switch to NodePort

To use the NodePort to run `./scripts/setup-with-nodeport` which will provide:

* A local KinD cluster that:
    * Has ports 30001, 30002, 30003 exposed
    * Is running Kratix
* Updates to the Promise resources that support NodePort

You are now ready to apply the Promise and make Resource Requests per the top level README.

## Pipeline image

The resources used in the pipeline were downloaded using `./scripts/fetch-pipeline-resources`.


To build the image:
```
./scripts/pipeline-image build
```

To load the image to the local kind platform cluster:
```
./scripts/pipeline-image load
```

To push the image to ghcr.io:
```
./scripts/pipeline-image push
```

## Testing
To test the promise install kratix, and then:
```
kubectl apply -f promise.yaml
./scripts/test promise
```

This asserts the Promise is installed correctly.

To test the resource request:
```
kubectl apply -f resource-request.yaml
./scripts/test resource-request
```
